{% extends "base_menu.html" %}

{% block content %}
<h3> Station to Station  Search </h3> 

<form>
{% csrf_token %}
{{train_form}}
<input class="btn" type="submit" name="submit" value="Search">
</form>
<p>Trains from <b>{{depart_input}}</b> to <b>{{dest_input}}</b> on <b>{{date_input}}</b></p> 

<table>
    <tr> 
        <th> No. </th> <th>Depart.</th> <th>Dest.</th> 
         <th>Arrive Time</th> <th>Depart Time</th> <th> Time Length </th> 
         <th> Seats </th> <th> Price (Yuan) </th> <th>  </th>
    </tr>
    {% for train in trains %}
    <tr>
            
        <td> <a href="{% url 'timetable_tool:route_search2' train.train_link date_input%}">{{train.train_number }}</a> </td>
        <td>{{ train.station_depart }} </td>
        <td>{{ train.station_dest}}</td>
        <td>{{ train.dep_time}} </td>
        <td>{{ train.arr_time}} {{train.day_str}}</td>
        <td> {{train.time_delta}} </td>
        <td> {{train.seats_avaliable}} </td>
        <td> {{train.price}} </td>
        <td>
            <a href="{% url 'timetable_tool:ticket_buy' train.TRfrom_id train.TRto_id date_input%}" class="btn btn-secondary">Buy Ticket</a>
        </td>
    </tr>
    {% endfor %}
</table>
<script>
jQuery(function() {
    $("#id_station_input").on('keyup', function(){
        var value = $(this).val();
        $.ajax({
            url: "{% url 'timetable_tool:station_autocomplete' %}",
            data: {
                'search': value 
            },
            dataType: 'json',
            success: function (data) {
                result_list = data.result_list;
                $("#id_station_input").autocomplete({
                source: result_list,
                minLength: 2 
                });       
            }
        });        
    });
});

jQuery(function() {
    $("#id_station_input2").on('keyup', function(){
        var value = $(this).val();
        $.ajax({
            url: "{% url 'timetable_tool:station_autocomplete' %}",
            data: {
                'search': value 
            },
            dataType: 'json',
            success: function (data) {
                result_list = data.result_list;
                $("#id_station_input2").autocomplete({
                source: result_list,
                minLength: 2 
                });       
            }
        });        
    });
    });
</script>
{% endblock %}